<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EnTT: Push EnTT across boundaries</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EnTT
   &#160;<span id="projectnumber">3.5.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Push EnTT across boundaries </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md85"></a>
Working across boundaries</h1>
<p><code>EnTT</code> has historically had a limit when used across boundaries on Windows in general and on GNU/Linux when default visibility was set to hidden. The limitation was mainly due to a custom utility used to assign unique, sequential identifiers with different types.<br  />
 Fortunately, nowadays using <code>EnTT</code> across boundaries is straightforward. In fact, everything just works transparently in almost all cases. There are only a few exceptions, easy to deal with anyway.</p>
<h2><a class="anchor" id="autotoc_md86"></a>
The EnTT way</h2>
<p>Many classes in <code>EnTT</code> make extensive use of type erasure for their purposes. This isn't a problem in itself (in fact, it's the basis of an API so convenient to use). However, a way is needed to recognize the objects whose type has been erased on the other side of a boundary.<br  />
 The <code>type_info</code> class template is how identifiers are generated and thus made available to the rest of the library. The <code>type_index</code> class template makes all types <em>indexable</em> instead, so as to speed up the lookup.</p>
<p>In general, these classes don't arouse much interest. The only exceptions are:</p>
<ul>
<li>When a conflict between identifiers occurs (definitely uncommon though) or when the default solution proposed by <code>EnTT</code> isn't suitable for the user's purposes.<br  />
 The section dedicated to <code>type_info</code> contains all the details to get around the problem in a concise and elegant way. Please refer to the specific documentation.</li>
<li>When working with linked libraries that also export all required symbols.<br  />
 Compile definitions <code>ENTT_API_EXPORT</code> and <code>ENTT_API_IMPORT</code> should be passed respectively where there is a need to import or export the symbols defined by <code>EnTT</code>, so as to make everything work nicely across boundaries.</li>
<li>When working with plugins or shared libraries that don't export any symbol. In this case, <code>type_index</code> confuses the other classes by giving potentially wrong information to them.<br  />
 To avoid problems, it's required to provide a custom generator or to suppress the index generation as a whole:</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Type&gt;</div>
<div class="line"><span class="keyword">struct </span><a class="code" href="structentt_1_1type__index.html">entt::type_index</a>&lt;Type&gt; {};</div>
</div><!-- fragment --><p>All classes that use <code>type_index</code> perform also a check on the possibility of creating indexes for types. If it's not a viable solution, they fallback on the type id provided by <code>type_info</code>. The latter makes everything stable across boundaries.<br  />
 This is why suppressing the generation of the indexes solves the problem. In case it's still necessary to associate sequential indexes with types, users can refer to the <code>family</code> class, although knowing that these will not be stable across boundaries.</p>
<p>For anyone who needs more details, the test suite contains multiple examples covering the most common cases.<br  />
 It goes without saying that it's impossible to cover all the possible cases. However, what is offered should hopefully serve as a basis for all of them.</p>
<h2><a class="anchor" id="autotoc_md87"></a>
Meta context</h2>
<p>The runtime reflection system deserves a special mention when it comes to using it across boundaries.<br  />
 Since it's linked to a static context to which the visible components are attached and different contexts don't relate to each other, they must be <em>shared</em> to allow the use of meta types across boundaries.</p>
<p>Sharing a context is trivial though. First of all, the local one must be acquired in the main space:</p>
<div class="fragment"><div class="line"><a class="code" href="structentt_1_1meta__ctx.html">entt::meta_ctx</a> ctx{};</div>
</div><!-- fragment --><p>Then, it must passed to the receiving space that will set it as its global context, thus releasing the local one that remains available but is no longer referred to by the runtime reflection system:</p>
<div class="fragment"><div class="line"><a class="code" href="structentt_1_1meta__ctx.html#ac42cb95e72447d49b7e1400512426e21">entt::meta_ctx::bind</a>(ctx);</div>
</div><!-- fragment --><p>From now on, both spaces will refer to the same context and on it will be attached the new visible meta types, no matter where they are created.<br  />
 A context can also be reset and then associated again locally as:</p>
<div class="fragment"><div class="line"><a class="code" href="structentt_1_1meta__ctx.html#ac42cb95e72447d49b7e1400512426e21">entt::meta_ctx::bind</a>{<a class="code" href="structentt_1_1meta__ctx.html">entt::meta_ctx</a>{});</div>
</div><!-- fragment --><p>This is allowed because local and global contexts are separated. Therefore, it's always possible to make the local context the current one again.</p>
<p>Before to release a context, all locally registered types should be reset to avoid dangling references. Otherwise, if a type is accessed from another space by name, there could be an attempt to address its parts that are no longer available.</p>
<h2><a class="anchor" id="autotoc_md88"></a>
Memory Management</h2>
<p>There is another subtle problem due to memory management that can lead to headaches.<br  />
 It can occur where there are pools of objects (such as components or events) dynamically created on demand. This is usually not a problem when working with linked libraries that rely on the same dynamic runtime. However, it can occur in the case of plugins or statically linked runtimes.</p>
<p>As an example, imagine creating an instance of <code>registry</code> in the main executable and sharing it with a plugin. If the latter starts working with a component that is unknown to the former, a dedicated pool is created within the registry on first use.<br  />
 As one can guess, this pool is instantiated on a different side of the boundary from the <code>registry</code>. Therefore, the instance is now managing memory from different spaces and this can quickly lead to crashes if not properly addressed.</p>
<p>To overcome the risk, it's recommended to use well-defined interfaces that make fundamental types pass through the boundaries, isolating the instances of the <code>EnTT</code> classes from time to time and as appropriate.<br  />
 Refer to the test suite for some examples, read the documentation available online about this type of issues or consult someone who has already had such experiences to avoid problems. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="astructentt_1_1meta__ctx_html_ac42cb95e72447d49b7e1400512426e21"><div class="ttname"><a href="structentt_1_1meta__ctx.html#ac42cb95e72447d49b7e1400512426e21">entt::meta_ctx::bind</a></div><div class="ttdeci">static void bind(meta_ctx other) noexcept</div><div class="ttdoc">Binds the meta system to a given context.</div><div class="ttdef"><b>Definition:</b> <a href="ctx_8hpp_source.html#l00056">ctx.hpp:56</a></div></div>
<div class="ttc" id="astructentt_1_1meta__ctx_html"><div class="ttname"><a href="structentt_1_1meta__ctx.html">entt::meta_ctx</a></div><div class="ttdoc">Opaque container for a meta context.</div><div class="ttdef"><b>Definition:</b> <a href="ctx_8hpp_source.html#l00051">ctx.hpp:51</a></div></div>
<div class="ttc" id="astructentt_1_1type__index_html"><div class="ttname"><a href="structentt_1_1type__index.html">entt::type_index</a></div><div class="ttdoc">Type index.</div><div class="ttdef"><b>Definition:</b> <a href="type__info_8hpp_source.html#l00059">type_info.hpp:59</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
